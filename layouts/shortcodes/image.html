{{- /* from https://maku77.github.io/hugo/misc/image-processing.html --> */ -}}

{{- $srcs := split (.Get "src") "," }}
{{- $root := . }}


<figure>
  {{range $src := $srcs}}
    {{- $width := or ($root.Get "h") "220" }}
    {{- $size := printf "x%s" $width }}
    {{- $res := $root.Page.Resources.GetMatch $src }}
    {{- $image := $res.Resize $size }}
    {{- $imageUrl := $image.RelPermalink }}
  <a href="{{ $src }}" target="_blank">
    <img src="{{ $imageUrl }}" />
  </a>
  {{end}}
  {{- $title := $root.Get "title" }}
  {{- with $title }}
    <figcaption>{{ . }}</figcaption>
  {{- end }}
</figure>